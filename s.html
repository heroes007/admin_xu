<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>
<body>
    <div class="box">
        <span class="div">
            比较指定范围的边界点和当前范围的边界点，根据它们的顺序返回 -1、0 和 1。比较哪个边界点由它的第一个参数指定，它的值必须是前面定义的常量之一。
        </span>
    </div>
    <ul id="ul"> 

    </ul>
</body>
<style>
    .select{
        background-color: #f00;
    }
</style>
<script>
    $('body').click((e) => {
        if(window.getSelection) {

            //获取选中数据
            selectionObj = window.getSelection();
            let a = document.createRange()
            
            var range = window.getSelection().getRangeAt(0);

            // a.selectNodeContents($('.box')[0])  

            console.log(selectionObj.getRangeAt(0).startContainer)

            //设置选中的开始和结束位置
            a.setStart(selectionObj.getRangeAt(0).startContainer, selectionObj.getRangeAt(0).startOffset)
            a.setEnd(selectionObj.getRangeAt(0).endContainer, selectionObj.getRangeAt(0).endOffset)

            //复制选中节点
            var clone = a.cloneContents()

            //删除
            a.extractContents()

            //插入节点
            // var tem = document.createElement('span')
            // tem.textContent = selectionObj.toString()
            // tem.append(clone)
            // tem.className = 'select'
            // a.insertNode(tem)

            //调用
            // if(window.getSelection().anchorNode.nextElementSibling.innerHTML) {
                // var ul = document.getElementById("ul")
                // var li = document.createElement('li')
                // li.innerHTML = "<span style='color: #f00'>红色</span><span style='color: #0f0'>绿色</span><span style='color: #00f'>蓝色</span>"
                // ul.append(li)
                change(clone, a)
            // }
        }
    })
    function change(clone, a) {
        var tem = document.createElement('span')
        tem.textContent = selectionObj.toString()
        tem.append(clone)
        tem.className = 'select'
        a.insertNode(tem)
    }

    function initial(){
        let a = document.createRange()
        var dom = $('.div')[0].childNodes[0]

        let arr = [
            {first: 19, end: 25, content: '123'},
            {first: 14, end: 18, content: '123'},
            {first: 16, end: 25, content: '123'},
        ]

        arr.forEach(item => {
            console.log(item,'s')
            a.setStart(dom, item.first)
            a.setEnd(dom, item.end)

            var clone = a.cloneContents()
            a.extractContents()

            var tem = document.createElement('span')
            // tem.textContent = item.content
            tem.append(clone)
            tem.className = 'select'
            a.insertNode(tem)
        })
    }

    initial()
</script>
</html>